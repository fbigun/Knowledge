磁盘阵列 RAID1 与异地备份

一个硬盘，不管它来自什么厂商，也不管它是机械的还是固态的，它出现故障只是时间早晚的问题
一个人，不管 TA 来自什么地方，也不管 TA 是男的还是女的，TA 总有误操作的时候
我就不信你们没有丢过一点数据！

既然问题摆在面前那怎么办呢？

我觉得对于实时更新的重要数据至少本地 raid + 异地备份
对于需要永久保存的数据来说至少异地备份
最好还要加上版本控制功能
当然你还得注意硬盘的健康状况，真的是比人还要脆弱
btrfs 文件系统的一些特性非常不错，快照，克隆，字卷，校验等， 不知道现在稳定到什么程度了，听说上个月在最新的 Linux 稳定版内核 3.12 中被修改成了 stable, 有时间去试一试

这篇文章比较长，关于如何在树莓派上组建磁盘阵列 raid1, 我另外写了一篇文章 《Debian 组建软 RAID 1 磁盘阵列》

下面就来说说怎么异地备份吧，使用 rsync 工具, 且通过 ssh 传输，比较安全
在本地主机上（将树莓派中的数据备份到这个机子）操作

首先创建公钥和私钥，一路回车就可以了。假设生成为 “~/.ssh/id_rsa” 和 “~/.ssh/id_rsa.pub”

ssh-keygen -t rsa
将私钥加入 ssh-agent

ssh-add ~/.ssh/id_rsa
将公钥复制到树莓派上

ssh-copy-id pi@192.168.1.2
执行下面的命令，作用是：保存所有文件属性与权限，删除 dst 中 src 没有的文件（传输结束以后再删除）， 通过 ssh 将 192.168.1.2 机子中 “/home/pi/nas-data/nas-data/save/” 目录备份到本地主机 “/home/mwum/save/” 目录， 并且显示详细信息

rsync -av -delete-after -e ssh pi@192.168.1.2:/home/pi/nas-data/nas-data/save/ /home/mwum/save/
如果需要定时执行备份，方法如下

编辑当前用户的任务

crontab -e
例如加入一行，表示每天凌晨2点自动备份

0 2 * * * rsync -av -delete-after -e ssh pi@192.168.1.2:/home/pi/nas-data/nas-data/save/ /home/mwum/save/
基本格式，共 6 列，如下
分钟(0-59) | 小时(0-23) | 日期(1-31) | 月份(1-12) 星期(0-6, 0 表示星期日) | 命令

如果是通过外网访问，也是一样的，把 ip 改一下就可以了
若没有固定的公网 ip, 请使用 ddns; 若使用了路由器，请设置端口映射

不知不觉写那么多了，就告一段落吧，为啥是今天呢，是一部动画完结的日子